<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Personaje 3D GLB - GitHub Pages</title>
<style>
body { margin:0; overflow:hidden; background:#000; }
canvas { display:block; }
</style>
</head>
<body>

<script type="module">
// Importar Three.js y módulos modernos
import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.module.js';
import { OrbitControls } from 'https://cdn.jsdelivr.net/npm/three@0.158.0/examples/jsm/controls/OrbitControls.js';
import { GLTFLoader } from 'https://cdn.jsdelivr.net/npm/three@0.158.0/examples/jsm/loaders/GLTFLoader.js';

// Escena y cámara
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x050505);
const camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 1000);
camera.position.set(0,8,15);

// Renderer
const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// Controles
const controls = new OrbitControls(camera, renderer.domElement);
controls.target.set(0,1,0);
controls.update();

// Luz
const dirLight = new THREE.DirectionalLight(0xffffff,1);
dirLight.position.set(10,20,10);
scene.add(dirLight);
scene.add(new THREE.AmbientLight(0x404040));

// Cuadrícula grande
const grid = new THREE.GridHelper(50,50,0xffffff,0x555555);
scene.add(grid);

// Cargar GLB
let character;
const loader = new GLTFLoader();
loader.load('man.glb', (gltf)=>{
    character = gltf.scene;
    character.scale.set(0.3,0.3,0.3); // personaje pequeño
    character.position.y = 0.3;       // un poco por encima del piso
    scene.add(character);
}, undefined, (err)=>console.error('Error cargando GLB:', err));

// Movimiento
const keys = {};
window.addEventListener('keydown', e=>keys[e.key.toLowerCase()]=true);
window.addEventListener('keyup', e=>keys[e.key.toLowerCase()]=false);

let velocityY = 0;
const gravity = -0.02;

function animate(){
    requestAnimationFrame(animate);

    if(character){
        const speed = 0.15;
        if(keys['w']) character.position.z -= speed;
        if(keys['s']) character.position.z += speed;
        if(keys['a']) character.position.x -= speed;
        if(keys['d']) character.position.x += speed;

        // gravedad
        velocityY += gravity;
        character.position.y += velocityY;
        if(character.position.y < 0.3){ character.position.y = 0.3; velocityY = 0; }

        // cámara tercera persona
        const offset = new THREE.Vector3(0,4,8);
        camera.position.lerp(character.position.clone().add(offset),0.1);
        camera.lookAt(character.position);
    }

    renderer.render(scene,camera);
}
animate();

// Ajustar al tamaño de la ventana
window.addEventListener('resize', ()=>{
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>

</body>
</html>
