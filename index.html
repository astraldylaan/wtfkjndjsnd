<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Personaje 3D GLB Grande</title>
<style>
body { margin:0; overflow:hidden; background:#000; }
canvas { display:block; }
</style>
</head>
<body>

<!-- Three.js y GLTFLoader -->
<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/examples/js/controls/OrbitControls.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/examples/js/loaders/GLTFLoader.js"></script>

<script>
let scene = new THREE.Scene();
scene.background = new THREE.Color(0x050505);

// Cámara
let camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 1000);
camera.position.set(0, 8, 15);

// Renderer
let renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// Controles
let controls = new THREE.OrbitControls(camera, renderer.domElement);
controls.target.set(0,1,0);
controls.update();

// Luz
let dirLight = new THREE.DirectionalLight(0xffffff,1);
dirLight.position.set(10,20,10);
scene.add(dirLight);
scene.add(new THREE.AmbientLight(0x404040));

// Cuadrícula grande
let grid = new THREE.GridHelper(50,50,0xffffff,0x555555); // tamaño 50x50
scene.add(grid);

// Cargar GLB
let character;
const loader = new THREE.GLTFLoader();
loader.load('man.glb', function(gltf){
    character = gltf.scene;
    character.scale.set(0.3,0.3,0.3); // personaje pequeño
    character.position.y = 0.3; // un poco por encima de la cuadrícula
    scene.add(character);
}, undefined, function(error){
    console.error('Error cargando GLB:', error);
});

// Movimiento
let keys = {};
window.addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
window.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);

let velocityY = 0;
const gravity = -0.02;

function animate(){
    requestAnimationFrame(animate);

    if(character){
        const speed = 0.15; // más rápido
        if(keys['w']) character.position.z -= speed;
        if(keys['s']) character.position.z += speed;
        if(keys['a']) character.position.x -= speed;
        if(keys['d']) character.position.x += speed;

        // gravedad
        velocityY += gravity;
        character.position.y += velocityY;
        if(character.position.y < 0.3){ // piso
            character.position.y = 0.3;
            velocityY = 0;
        }

        // cámara tercera persona
        let offset = new THREE.Vector3(0,4,8);
        camera.position.lerp(character.position.clone().add(offset),0.1);
        camera.lookAt(character.position);
    }

    renderer.render(scene,camera);
}
animate();

// Ajuste ventana
window.addEventListener('resize', ()=>{
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>
</body>
</html>
