<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Personaje 3D GLB - GitHub</title>
<style>
body { margin:0; overflow:hidden; background:#000; }
canvas { display:block; }
</style>
</head>
<body>

<!-- Three.js y GLTFLoader -->
<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/examples/js/controls/OrbitControls.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/examples/js/loaders/GLTFLoader.js"></script>

<script>
let scene, camera, renderer, controls;
let character;
let velocityY = 0;
const gravity = -0.02;

// Escena
scene = new THREE.Scene();
scene.background = new THREE.Color(0x050505);

// Cámara
camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 1000);
camera.position.set(0,5,10);

// Renderer
renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// Controles
controls = new THREE.OrbitControls(camera, renderer.domElement);
controls.target.set(0,1,0);
controls.update();

// Luz
const dirLight = new THREE.DirectionalLight(0xffffff,1);
dirLight.position.set(5,10,5);
scene.add(dirLight);
scene.add(new THREE.AmbientLight(0x404040));

// Cuadrícula
const grid = new THREE.GridHelper(10,10);
scene.add(grid);

// Cargar GLB
const loader = new THREE.GLTFLoader();
loader.load('man.glb', function(gltf){
    character = gltf.scene;
    character.scale.set(1,1,1); // ajustar según tu modelo
    character.position.y = 0;
    scene.add(character);
}, undefined, function(error){
    console.error(error);
});

// Movimiento
const keys = {};
window.addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
window.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);

function updateMovement(){
    if(!character) return;
    const speed = 0.1;
    if(keys['w']) character.position.z -= speed;
    if(keys['s']) character.position.z += speed;
    if(keys['a']) character.position.x -= speed;
    if(keys['d']) character.position.x += speed;
}

// Gravedad
function updateGravity(){
    if(!character) return;
    velocityY += gravity;
    character.position.y += velocityY;
    if(character.position.y <= 0){ character.position.y = 0; velocityY = 0; }
}

// Cámara tercera persona
function updateCamera(){
    if(!character) return;
    const offset = new THREE.Vector3(0,4,8);
    const targetPos = character.position.clone().add(offset);
    camera.position.lerp(targetPos,0.1);
    camera.lookAt(character.position);
}

// Loop
function animate(){
    requestAnimationFrame(animate);
    updateMovement();
    updateGravity();
    updateCamera();
    renderer.render(scene,camera);
}
animate();

// Resize
window.addEventListener('resize', ()=>{
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>
</body>
</html>
